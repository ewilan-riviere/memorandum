# User Registration

In our previous lesson, we toured our example appâ€™s starting code and saw that any user off the internet was able to access our dashboard, which displays a list of events from our mock database. We only want users who have an account with our app to be able to access those events.

If you download the starting code in the Lesson Resources of this page, youâ€™ll see that our **server.js** file now only returns those events when the `/dashboard` endpoint is accessed by an API call that includes a token.

**server.js**

```
app.get('/dashboard', verifyToken, (req, res) => { //verifyToken is middleware
jwt.verify(req.token, 'the_secret_key', err => { // verifies token
if (err) { // if error, respond with 401 code
res.sendStatus(401)
} else { // otherwise, respond with private data
res.json({
events: events
})
}
})
})
```

As a reminder, the **server.js** file is our mock authorization server running Express.js. We will run API calls against this server, and it is already configured for proper token authentication. If we run our app now (`npm run start` )and try to access the dashboard, weâ€™ll get a 401 error in our console.

![](https://firebasestorage.googleapis.com/v0/b/vue-mastery.appspot.com/o/flamelink%2Fmedia%2F1578372684280_0.png?alt=media&token=ee7cafb3-bca0-4506-9f36-91666da9ea39)

So we need to add to our app so that when a user is registered, they receive a token, which we can send along as we make a call out for that protected data. The `/dashboard` endpoint will then verify that token. If everything is good, it will respond with the private data we are requesting.

The steps weâ€™ll take in this lesson include:

1. Create a new **RegisterUser.vue** component
2. This will accept a name, email, and password from the user, and use Vuex to make a call out to our serverâ€™s `/register` endpoint
3. Add to our Vuex store
4. We need an Action to register users and a Mutation that stores the response received from our serverâ€™s `/register` endpoint and adds the received token to our Axios header
5. Add **RegisterUser** as a route

Letâ€™s get started.

---

## Creating a RegisterUser component

So what does a component look like that registers users? Youâ€™ve seen a lot of them before in other apps. Weâ€™re essentially building a small form that takes in a userâ€™s information, which we use to create their new account.

![](https://firebasestorage.googleapis.com/v0/b/vue-mastery.appspot.com/o/flamelink%2Fmedia%2F1578372684281_1.png?alt=media&token=9e5caf0e-0170-4944-99b6-b16f821eeb46)

So what kind of information are we gathering? Weâ€™ll need a `name`, `email` and `password` from our new user, which means weâ€™ll need to add those as fields in our componentâ€™s data, like so:

ðŸ“ƒ **src/views/RegisterUser.vue**

```
data () {
return {
name: '',
email: '',
password: ''
}
},
```

Now in the componentâ€™s template we can create a form and add an `input` for each of those fields and bind them to the data with `v-model`. While weâ€™re at it, weâ€™ll give each input a `label`, and add a button that will eventually trigger our submit behavior.

ðŸ“ƒ **src/views/RegisterUser.vue**

```
<template>
    <div>
        <form>
            <label for="name">
                Name:
            </label>
            <input v-model="name" type="text" name="name" value>

            <label for="email">
                Email:
            </label>
            <input v-model="email" type="email" name="email" value>

            <label for="password">
                Password:
            </label>
            <input v-model="password" type="password" name value>

            <button type="submit" name="button">
                Register
            </button>
        </form>
    </div>
</template>
```

Now our data fields will be populated as the user types into them. But what do we want to do with that user data weâ€™ve collected? We need to send it as credentials to our backend, to the `/register` endpoint, when a user clicks our button. Since the button is of type `submit` we need to add `@submit.prevent="register"` to the `form` element to prevent the default behavior. That `register` method name? Letâ€™s write that method now.

We need the `register` method to take the userâ€™s credentials and `dispatch` a Vuex Action (which weâ€™ll write in a minute).

ðŸ“ƒ **src/views/RegisterUser.vue**

```
methods: {
register () {
this.$store
.dispatch('register', {
name: this.name,
email: this.email,
password: this.password
})
}
}
```

We are about to add the `register` Action to our Vuex store, but I wanted you to first see that weâ€™re taking an object with the `name`, `email` and `password` from our **RegisterUser** component, and passing it into the `register` Action as the payload. Now letâ€™s head into our Vuex store and write out that Action.

---

## Setting up Vuex

Since our `register` Action will be making an API call, weâ€™ll need to import the Axios library into our **store.js** file. The Action will then look like this:

ðŸ“ƒ **src/store.js**

```
import axios from 'axios'
...
actions: {
register ({ commit }, credentials) {
return axios
.post('//localhost:3000/register', credentials)
.then(({ data }) => {
console.log('user data is', userData)
commit('SET_USER_DATA', data)
})
}
}
```

Weâ€™re making an Axios `post` request to our serverâ€™s `register` endpoint. While making this call, weâ€™re sending along the userâ€™s `credentials` (name, email, password), which we passed in as the payload from the **RegisterUser** component when we dispatched this Action.

Our dummy serverâ€™s `register` endpoint will take those user credentials, add the user to our **user.json** file, then send us back a response object that includes a JWT `token`, along with the userâ€™s `name` and `email`. Since we are console.logging the `data` we get back, we can see that response in our browserâ€™s devtools. But first we need to add RegisterUser as as a route so we can access it, so letâ€™s quickly do that now.

---

## Adding RegisterUser to router.js

Weâ€™ll just import and add as a route inside the **router.js** file.

ðŸ“ƒ **src/router.js**

```
import Vue from 'vue'
import Router from 'vue-router'
import Home from './views/Home.vue'
import Dashboard from './views/Dashboard.vue'
import RegisterUser from './views/RegisterUser.vue'

Vue.use(Router)
const router = new Router({
mode: 'history',
base: process.env.BASE_URL,
routes: [
{
path: '/',
name: 'home',
component: Home
},
{
path: '/dashboard',
name: 'dashboard',
component: Dashboard
},
{
path: '/register',
name: 'register',
component: RegisterUser
}
]
})
```

---

## Storing the Serverâ€™s Response

Now we can head to the app running in the browser, pull up the `/register` route, and create a new account.

![](https://firebasestorage.googleapis.com/v0/b/vue-mastery.appspot.com/o/flamelink%2Fmedia%2F1578372694018_2.png?alt=media&token=05008844-417b-49b6-a3c3-75f869ae9596)

When we click the register button, weâ€™ll see that our serverâ€™s response was logged to the console:

![](https://firebasestorage.googleapis.com/v0/b/vue-mastery.appspot.com/o/flamelink%2Fmedia%2F1578372696281_3.png?alt=media&token=a2f07f03-133d-48a2-b7ae-116f78cdbd33)

As we learned in the previous lesson, we then need to take that data and store it in our Vuex State, store a copy of it in the browserâ€™s local storage, and add the token into our Axios header. Weâ€™ll accomplish those steps in a Mutation called `SET_USER_DATA`, which weâ€™re about to write.

But first, since that Mutation will be adding the user to our Vuex State, we need to add a `user` field to our State.

ðŸ“ƒ **src/store.js**

```
state: {
user: null
},
```

Now letâ€™s write the Mutation that will add it to the State, along with adding a copy to local storage.

ðŸ“ƒ **src/store.js**

```
mutations: {
SET_USER_DATA (state, userData) {
state.user = userData
localStorage.setItem('user', JSON.stringify(userData))
},
```

Notice how weâ€™re using the `JSON.stringify` method to convert the JavaScript object into a JSON string.

Next, we need to add the token that lives in the `userData` into our Axios header, so that when we make API calls with Axios, our server will have the â€œkeyâ€ (JWT token) to unlock our locked `/dashboard` endpoint.

ðŸ“ƒ **src/store.js**

```
import axios from 'axios'
...
mutations: {
SET_USER_DATA (state, userData) {
state.user = userData
localStorage.setItem('user', JSON.stringify(userData))
axios.defaults.headers.common['Authorization'] = `Bearer ${
userData.token
}`
},
```

This code may look confusing at first, but weâ€™re simply setting the default `Authorization` header of our Axios instance so that it includes the JWT token. If youâ€™re wondering what `Bearer` means, itâ€™s just the _type_ of Authentication being used. You can read more about it [here](https://developers.google.com/gmail/markup/actions/verifying-bearer-tokens). You just need to know that weâ€™re giving Axios the JWT token so the server can use it unlock its protected `/dashboard` endpoint.

Great. Now we have `user` State, which our `SET_USER_DATA` populates when our server returns the `userData` in response to our API call. Weâ€™ve stored a copy of it in our local storage so we can reset our State in case of a browser refresh (we havenâ€™t yet implemented that reset code, but you can expect it in a future lesson), and weâ€™ve given Axios the key it needs to unlock our serverâ€™s dashboard route so we can access that private data: the events that live in our mock database.

---

## Redirecting to Dashboard

Weâ€™re about to check to see if this all works, but we need to consider where we send the user once they successfully register with our app. Currently, when they they are click the register button, they arenâ€™t taken anywhere. We should be redirecting them to the dashboard once they register successfully, so letâ€™s implement that now.

Back in our RegisterUser component, weâ€™ll add that redirect:

ðŸ“ƒ **src/views/RegisterUser.vue**

```
methods: {
register () {
this.$store
.dispatch('register', {
name: this.name,
email: this.email,
password: this.password
})
.then(() => {
this.$router.push({ name: 'dashboard' })
})
}
}
```

Now, once the user successfully registers, they will `then` be routed to the `dashboard`. Great! Now weâ€™re ready to check this out in the browser.

---

## Checking the Browser

If we head into the browser, create an account, and hit the register button, we should now be getting back our private events.

![](https://firebasestorage.googleapis.com/v0/b/vue-mastery.appspot.com/o/flamelink%2Fmedia%2F1578372698983_4.png?alt=media&token=69bb33b2-0828-4c48-820d-f6e7f6d23bed)

It works! If we pop open the devtools and inspect the network tab, we can see that the register call was made, as well as a call to the dashboard, where we can indeed see our token was added in the Authorization header.

![](https://firebasestorage.googleapis.com/v0/b/vue-mastery.appspot.com/o/flamelink%2Fmedia%2F1578372701730_5.png?alt=media&token=ad6f5e9d-43e1-4caf-9daa-68fb5a85c521)

Remember when we covered the structure of a JWT in the first lesson? Notice the three parts of that JWT token, each separated by a period.

Awesome. We did it!

---

## Whatâ€™s next?

Now that weâ€™ve started registering users, in the next lesson weâ€™ll look at logging a user back into the account theyâ€™ve already created. As we progress through the course weâ€™ll also handle what to do when a user tries to access the dashboard route when they arenâ€™t logged in.